Tu es lâ€™AGENT OUTILS.
Tu gÃ©nÃ¨res UNE fonction Python utilitaire + les mÃ©tadonnÃ©es nÃ©cessaires, au format JSON strict.

ğŸ¯ Objectif Outil Ã  gÃ©nÃ©rer

CrÃ©er une fonction Python nommÃ©e write_last_30_gmail_subjects_to_sheet() qui :

rÃ©cupÃ¨re les 30 derniers e-mails du compte Gmail (boÃ®te de rÃ©ception)

extrait uniquement leurs objets (subject)

Ã©crit ces objets dans une colonne dâ€™un Google Sheet

les place de A1 Ã  A30 

remplace tout contenu existant dans cette plage

ğŸ“Œ Contraintes dâ€™authentification

Lâ€™outil NE DOIT PAS gÃ©rer OAuth.

Il NE DOIT PAS lire, crÃ©er ou remplir :
client_secret.json, token.json, service_account.json, .env contenant des valeursâ€¦

Il doit obligatoirement rÃ©cupÃ©rer le service Gmail dÃ©jÃ  authentifiÃ© via :

from output.get_gmail_service import get_gmail_service


Les credentials doivent obligatoirement Ãªtre extraits via :

creds = gmail_service._http.credentials


Il doit construire le service Sheets en rÃ©utilisant ces credentials :

build("sheets", "v4", credentials=creds)


âš ï¸ INTERDICTION ABSOLUE : .authorize() ou toute re-Authentification.

ğŸ“¥ Sources de donnÃ©es

RÃ©cupÃ©ration Gmail :

Utiliser gmail_service.users().messages().list() avec :

maxResults=30

labelIds=["INBOX"]

q=None

order by DESC (dÃ©faut)

Pour chaque message, rÃ©cupÃ©rer lâ€™objet (header "Subject") via :

gmail_service.users().messages().get(userId="me", id=msg_id, format="metadata", metadataHeaders=["Subject"])


Si un mail nâ€™a pas dâ€™objet, utiliser "Sans objet".

ğŸ“¤ Destination Sheets

Le sheet Ã  cibler doit Ãªtre lu via une variable dâ€™environnement :

GOOGLE_SHEET_ID


Si elle est manquante, la fonction doit lever :

raise RuntimeError("La variable d'environnement GOOGLE_SHEET_ID est manquante.")


Les sujets doivent Ãªtre Ã©crits dans :

range : "A1:A30"

via values().update(..., valueInputOption="RAW")

âš™ï¸ Contraintes Clean-Code

Une seule fonction publique : write_last_30_gmail_subjects_to_sheet()

Typage strict (-> bool)

Docstring courte et Google style

Imports strictement nÃ©cessaires

Pas de print(), pas de logging, pas dâ€™affichage

Pas de classe, pas dâ€™utilitaire supplÃ©mentaire

Code original

ğŸ” Fichiers & .env

Tu dois dÃ©clarer : GOOGLE_SHEET_ID dans env_vars

ğŸš« Aucun fichier JSON de credentials ne doit Ãªtre gÃ©nÃ©rÃ©

ğŸš« Aucune valeur dans .env, uniquement des noms si utilisÃ©

ğŸ“¤ Format de rÃ©ponse OBLIGATOIRE

Tu dois renvoyer UNIQUEMENT :

{
  "source_code": "<code python propre et exÃ©cutable>",
  "metadata": {
    "nom": "write_last_30_gmail_subjects_to_sheet",
    "description": "RÃ©cupÃ¨re les 30 derniers objets Gmail et les Ã©crit dans Google Sheets.",
    "inputs": {},
    "output": "bool",
    "schema_output": {},
    "dependencies": ["google-api-python-client"],
    "env_vars": ["GOOGLE_SHEET_ID"],
    "config_files": [],
    "auth_files": [],
    "called_functions": ["get_gmail_service"],
    "pdf_files": []
  }
}


ğŸ“Œ Si un seul point nâ€™est pas respectÃ©, tu dois corriger automatiquement et renvoyer une rÃ©ponse 100% valide.